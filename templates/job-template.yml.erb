- name: lint-<%= branch_name %>
  plan:
  - get: git-branch
    resource: git-branch-<%= branch_name %>
    params: {depth: 20}
    trigger: true
  - get: concourse-configs
    resource: concourse-configs
    params: {depth: 20}
  - task: lint-task
    file: concourse-configs/tasks/lint.yml
    config:
      params:
        branch: <%= branch_name %>
  - put: lint-reports-<%= branch_name%>

- name: unit-tests-<%= branch_name %>
  plan:
  - get: git-branch
    resource: git-branch-<%= branch_name %>
    params: {depth: 20}
    trigger: true
  - get: concourse-configs
    resource: concourse-configs
    params: {depth: 20}
  - task: unit-tests-task
    file: concourse-configs/tasks/unit-tests.yml
    config:
      params:
        branch: <%= branch_name %>
  - put: unit-test-reports-<%= branch_name%>


- name: push-to-pcf-<%= branch_name %>
  plan:
  - get: lint-reports-<%= branch_name %>
    passed: [lint-<%= branch_name %>]
  - get: unit-test-reports-<%= branch_name %>
    passed: [unit-tests-<%= branch_name %>]
  - get: git-branch
    resource: git-branch-<%= branch_name %>
    params: {depth: 20}
    trigger: true
  - get: concourse-configs
    resource: concourse-configs
    params: {depth: 20}
  - task: push-to-pcf-task
    file: concourse-configs/tasks/pcf.yml
    config:
      params:
        branch: <%= branch_name %>
        repo: <%= repo_name %>

- name: ui-tests-<%= branch_name %>
  plan:
  - get: concourse-configs
    resource: concourse-configs
    params: {depth: 20}
    passed: [push-to-pcf-<%= branch_name %>]
  - task: run-unit-tests
    file: concourse-configs/tasks/ui-tests.yml
    config:
      params:
        TESTING_URL=<%= repo_name %>-<%= branch_name %>.apps.pcfdemo.tk